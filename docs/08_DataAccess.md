## Data Access / Доступ к данным

- [Data Access / Доступ к данным](#data-access--доступ-к-данным)
  - [Основные технологии доступа к данным](#основные-технологии-доступа-к-данным)
  - [Объектно-ориентированные механизмы](#объектно-ориентированные-механизмы)
  - [Базовая технология доступа к данным СОМ](#базовая-технология-доступа-к-данным-сом)
  - [Технология ODBC](#технология-odbc)
    - [Недостатки ODBC](#недостатки-odbc)
  - [DAO и RDO](#dao-и-rdo)
  - [Технология OLE DB](#технология-ole-db)
    - [Цели создания OLE DB](#цели-создания-ole-db)
    - [Технология OLE](#технология-ole)
    - [Суть OLE DB](#суть-ole-db)
    - [Основные понятия OLE DB](#основные-понятия-ole-db)
    - [Объектная модель OLE DB](#объектная-модель-ole-db)
    - [Доступ к OLE DB](#доступ-к-ole-db)
  - [Технология ADO](#технология-ado)
  - [Технология ADO.NET](#технология-adonet)
    - [Архитектура и принцип работы ADO.NET](#архитектура-и-принцип-работы-adonet)
    - [Сравнение ADO и ADO.NET](#сравнение-ado-и-adonet)
  - [Работа с базами данных в .NET Framework](#работа-с-базами-данных-в-net-framework)

### Основные технологии доступа к данным
На заре эпохи баз данных разработчикам достаточно было знать только те базы данных, которые они использовали. Но базы данных и их технологии развивались довольно быстро — от реляционных баз данных к нереляционным информационным хранилищам, таким, как электронная почта и файловые системы. Развитие баз данных сейчас идет в ногу со стремительными изменениями в технике. А с появлением клиент-серверных и многоуровневых архитектур разработчикам уже приходится разбираться во всем многообразии технологий баз данных. Большинство разработчиков потратили годы на изучение ODBC, DAO, RDO, OLE DB, ADO и RDS. К настоящему моменту Microsoft представила .NET Framework и вместе с ней новую технологию баз данных ADO.NET.

Как только мы начинаем углубляться в какую-то новую технологию, мы забываем, как она развивалась и что рационального за ней стоит. Проследив развитие технологий баз данных от ODBC до ADO.NET, проще выбрать подходящую технологию и оптимизировать ее для своих целей.

<dfn title="технология доступа к данным">Технологией доступа к данным</dfn> называется система интерфейсов, обеспечивающая взаимодействие между приложением и базой данных. Во многих системах управления базами данных имеются библиотеки, содержащие интерфейсы прикладного программирования (application programming interface – API), представляющие собой функции, при помощи которых можно выполнять с данными те или иные действия.

Для того, чтобы наиболее полно использовать возможности того или иного сервера баз данных, необходимо работать с ним напрямую, через API. Однако это означает полную зависимость приложения от того или иного сервера и сложность перехода на другую платформу, так как будет необходимо переписывать большое количество кода.

Этот вопрос призваны решить различные технологии доступа к данным. Они являются прослойкой между API конкретного сервера и приложением пользователя, предоставляя программисту простой унифицированный механизм работы с данными.

На сегодняшний день существует множество технологий доступа к данным, таких как:
- COM
- ODBC
- OLE DB
- ADO
- ADO.NET
- MIDAS

Все эти технологии основаны на единых принципах – объектных моделях доступа к удаленным БД, и разрабатываются, соответственно, на методах объектно-ориентированного программирования.

### Объектно-ориентированные механизмы
После того как объектно-ориентированные технологии стали доминирующими в системном программировании, разработчики приложений клиент-сервер также начали применять этот подход. В этом случае объекты на клиентах и серверах обмениваются сообщениями. Взаимодействие между объектами может быть основано на обмене сообщениями, на удаленном вызове процедур или непосредственно на объектноориентированных возможностях операционной системы.

Клиент, которому требуется услуга, посылает запрос брокеру объектных запросов, действующему как каталог всех доступных в сети удаленных услуг. Брокер вызывает соответствующий объект и передает ему необходимые данные. Затем удаленный объект обслуживает запрос и отвечает брокеру, который возвращает ответ клиенту.

*[COM]: Component Object Model
*[OLE]: Object Linking and Embedding
*[CORBA]: Common Object Request Broker Architecture
Успех объектно-ориентированного подхода зависит от того, насколько хорошо стандартизирован объектный механизм. К сожалению, в этой области сосуществуют сразу несколько конкурирующих схем. Одной из них является модель COM (Component Object Model — модель компонентных объектов) компании Microsoft, являющаяся основой технологии OLE (Object Linking and Embedding — связывание и внедрение объектов). Этот метод получил поддержку со стороны компании Digital Equipment Corporation, разработавшей механизм СОМ для операционной системы UNIX. С этим подходом конкурирует получившая широкую промышленную поддержку технология CORBA (Common Object Request Broker Architecture — обобщенная архитектура брокера объектных запросов), разработанная компанией Object Management Group. Архитектуру CORBA поддерживают компании IBM, Apple, Sun, а также многие другие.

Механизмы доступа к базам данных снижают сложность обмена информацией с базами, однако интерпретация результатов их работы также достаточно трудоемка. Поэтому реализованы наборы компонентов, предназначенные для взаимодействия с механизмами обмена.

Таким образом, можно выделить несколько субъектов, участвующих в движении информации между базой данных и приложением (например, пользовательским интерфейсом):
1) интерфейсная часть приложения или его программная часть, манипулирующая информацией, хранимой в базе данных;
2) компоненты, обеспечивающие связь приложения с механизмом доступа к базе данных;
3) механизм доступа к базе данных;
4) база данных.

При разработчике приложения-СУБД программист работает с наборами компонентов, предназначенных для обмена информацией с базами данных и ее отображения. В зависимости от выбранного механизма доступа к базе данных некоторые наборы компонентов могут не использоваться, однако все они, вне зависимости от особенностей используемой базы данных и механизма доступа к ней, имеют схожие свойства и методы.

### Базовая технология доступа к данным СОМ
*[COM]: Component Object Model
Технология доступа к удаленным данным Component Object Model (COM) – компонентная модель объектов, разработанная фирмой Microsoft как средство взаимодействия приложений (в том числе составных частей ОС Windows), функционирующих на одном ПК. На технологии СОМ построены такие методы управления удаленными объектами, как OLE, Автоматизация, ActivX.

Стандарт COM был разработан в 1993 году корпорацией Microsoft как основа для развития технологии OLE. <dfn title="объектная модель компонентов">Объектная Модель Компонентов</dfn> (Component Object Model, COM) — это технологический стандарт от компании Microsoft, предназначенный для создания программного обеспечения на основе взаимодействующих распределённых компонентов, каждый из которых может использоваться во многих программах одновременно. Стандарт COM воплощает в себе идеи полиморфизма[^полиморфизм] и инкапсуляции[^инкапсуляция] объектно-ориентированного программирования.

[^полиморфизм]: <dfn title="полиморфизм">Полиморфизм</dfn> — взаимозаменяемость объектов с одинаковым интерфейсом.

[^инкапсуляция]: <dfn title="инкапсуляция">Инкапсуляция</dfn> — свойство языка программирования, позволяющее объединить данные и код в объект и скрыть реализацию объекта от пользователя.

### Технология ODBC
ODBC (Open Database Connectivity – открытый доступ к базам данных) – разработанный компанией Microsoft универсальный интерфейс программирования приложений для доступа к базам данных.

В большинстве систем проектирования баз данных приложения основываются на одном типе баз данных. В таких простых схемах разработчик приложения может программировать напрямую, используя системный интерфейс базы данных. Хотя подобный подход обеспечивает быстрый и эффективный доступ к данным, могут возникать проблемы, когда задача расширяется, и разработчику приходится дорабатывать программу. При данном подходе это означает, что каждая готовая программа должна иметь различные версии с поддержкой всевозможных типов баз данных. Если компании расширяются или объединяются одна с другой, приложение должно получить доступ к базам данных, основанным на различных платформах.

Технология ODBC обеспечивает общий интерфейс для доступа к разнородным базам данных стандарта SQL. ODBC использует язык SQL как стандарт для доступа к данным. Этот интерфейс очень удобен: одно приложение может обращаться к различным базам данных SQL через общий набор команд. Таким образом, разработчик может создавать и распространять приложения, не привязываясь к конкретной базе данных.

Можно также добавить драйвер базы данных, чтобы приложение могло работать с базой данных по выбору пользователя. Менеджер драйверов является промежуточным звеном между приложением и базами данных. Интерфейс ODBC содержит набор функций, который управляет каждым инструментом базы данных. Если приложению нужно сменить используемую базу, разработчик просто заменяет один драйвер другим, и приложение может работать как обычно, без необходимости модификации кода программы.

Основной целью разработки протокола ODBC считается стандартизация механизмов взаимодействия с различными СУБД. Основная проблема, связанная с разработкой приложений, взаимодействующих с базами данных на основе специальных SQL API, состояла в том, что каждая СУБД имела собственный программный интерфейс доступа, каждый из них имел свои особенности и функционировал не совсем так, как другие. В связи с этим разработка приложения существенно зависела от используемой СУБД. Компания Microsoft сделала важный шаг для решения этой проблемы. Основная идея заключалась в разработке универсального интерфейса на уровне семейства операционных систем Windows, который мог бы быть поддержан в разных СУБД.

Технология ODBC (от англ. Open Database Connectivity – открытый механизм доступа к базам данных) – это компонент операционной системы Windows, предназначенный для унификации доступа к информации, хранящейся в базах данных различных видов. ODBC состоит из набора драйверов, осуществляющих операции обмена с определенными базами данных, и менеджера драйверов, осуществляющего передачу запросов от приложения к драйверу и передачу информации от драйвера к приложению.

Для получения и изменения данных используется язык запросов SQL, вне зависимости от того, поддерживается ли он базой данных, к которой обращается приложение. Если база данных не поддерживает язык SQL, то доступ к ней не отличается от доступа к БД, поддерживающим SQL. В этом и заключается унификация доступа к базам данных системой ODBC – приложение указывает название драйвера, который должен использоваться для подключения к базе данных, и передает запрос, в котором описан состав требуемой информации. Далее механизм ODBC выполняет все необходимые операции по получению информации, скрывая от приложения специфику работы с конкретной базой данных. Доступ приложений к ODBC осуществляется через API-функции, реализованные в динамических библиотеках.

#### Недостатки ODBC
Стандарт ODBC предназначен для реляционных баз данных, но в электронном мире существует достаточно много не реляционной информации, такой как сообщения электронной почты, документы, Web-страницы,  картинки, аудиофайлы и т.д. Эти данные не могут хранится в формате реляционных СУБД.

Для выполнения самых простых задач программисту приходится вызывать десятки сложных функций, т.к. доступ к драйверам ODBC осуществлялся посредством API.

<dfn title="интерфейс прикладного программирования">Интерфейс прикладного программирования</dfn> (Application Programming Interface, API) — набор готовых констант, структур и функций, используемых при программировании пользовательских приложений и обеспечивающих правильное взаимодействие между пользовательским приложением и операционной системой.

То есть для доступа к данным при помощи ODBC любая программа вызывает API-функции, причем в определённой последовательности:
- подключение к источнику данных;
- инициализация и настройка параметров SQL-запроса/оператора;
- формирование и выполнение запроса/оператора;
- получение результатов;
- отключение от источника данных.

### DAO и RDO

*[VB]: Visual Basic
*[DAO]: Data Access Object
ODBC использует низкоуровневый интерфейс, поэтому программисты на С и С++ реально задействуют все преимущества технологии ODBC. Программисты на Visual Basic (VB) не имеют простого доступа к интерфейсу ODBC. До появления VB 6.0 разработчики применяли высокоуровневый доступ к данным. Программисты VB используют технологию Data Access Object (DAO) для доступа к данным.

DAO базируется на технологии баз данных Microsoft Jet — процессоре баз данных, предназначенном для Microsoft Access. JET был первым объектно-ориентированным интерфейсом для связи с Access. Приложения, использующие Access, могут задействовать DAO для прямого доступа к данным. Поскольку DAO создавалась сразу же вслед за Access, применение этой технологии — самый быстрый и наиболее эффективный способ доступа к базам данных Access. DAO может работать и с отличными от Access базами данных, такими, как SQL Server и Oracle. DAO использует ODBC, но, поскольку метод DAO спроектирован специально для взаимодействия с JET, JET транслирует запросы между DAO и ODBC. Этот дополнительный шаг трансляции и является причиной замедления работы с базами данных, отличными от Access.

*[RDO]: Remote Data Objects
Чтобы преодолеть это ограничение, разработчики Microsoft создали RDO. RDO обращается к ODBС API напрямую, минуя JET.

Затем было введено ODBCDirect, расширение DAO, которое отодвигает RDO на задний план. DAO-приложение, используя ODBCDirect, обращается к базе данных, минуя проблемы, которые вызывает JET.

### Технология OLE DB
Спустя несколько лет ODBC становится стандартом для клиент-серверного доступа к базам данных. ODBC обеспечивает стандартный интерфейс, который требует функций SQL и оптимизирован под методы SQL. Однако что произойдет, если нужно будет обратиться к нереляционной базе данных, в которой не используются принципы SQL (например, Microsoft Exchange Server, хранилище которого не содержит данные реляционно)?

Технология OLE DB пришла на смену ODBC, с тем, чтобы устранить её недостатки. В начале 1990-x корпорация Microsoft представила OLE DB – объектно-ориентированный интерфейс для доступа к базам данных.

Технология OLE DB (от англ. Object Linking and Embedding DataBase – механизм доступа к базам данных с помощью технологии OLE) представляет собой набор СОМ-интерфейсов, обеспечивающих универсальный доступ приложений к базам данных и другим хранилищам информации (в том числе и нереляционным —  файловым системам, системам электронной почты и др.), в которых результатом запросов является информация, представленная в табличной форме.

#### Цели создания OLE DB

*[VSAM]: Virtual Storage Access Method
1. Создание объектных интерфейсов для элементов функциональности СУБД – запрос, обновление, управление транзакциями.

2. Увеличение гибкости:
   - дать потребителям данных возможность использовать только те объекты, которые им нужны.
   - дать поставщикам данных возможность открывать доступ к элементам функциональности СУБД.
   - обеспечить возможность доступа к функциональности с помощью множества различных интерфейсов.
   - сделать эти интерфейсы стандартизированными и расширяемыми.

3. Создание объектных интерфейсов для любых типов данных: реляционных баз данных (через ODBC или собственные интерфейсы СУБД), нереляционных баз данных, систем обработки файлов (VSAM и др.),  электронной почты и т.п.

4. Реализация стратегии, при которой данные не должны преобразовываться в другие форматы или перемещаться из того места, где они находятся.

#### Технология OLE
OLE (Object Linking and Embedding) — технология связывания и внедрения объектов в другие документы и объекты, разработанные корпорацией Microsoft.

OLE используется при обработке составных документов (compound documents), может быть использована при передаче данных между различными несвязанными между собой системами посредством интерфейса переноса (drag-and-drop), а также при выполнении операций с буфером обмена.

OLE-объекты являются COM-объектами и поддерживают все требуемые для таких объектов интерфейсы.

#### Суть OLE DB
Рассмотрим OLE DB. Технология OLE DB построена на ODBC и расширяет ее до компонентной архитектуры, которая обеспечивает высокоуровневый интерфейс доступа к данным. Эта архитектура предоставляет постоянный доступ к SQL-данным, не SQL-данным и неструктурированным источникам данных по локальным сетям и Internet. В действительности для доступа к SQL-данным OLE DB использует ODBC, потому что это самая подходящая архитектура для работы с SQL. На Рисунке 5 показано, что OLE DB состоит из трех компонентов: потребителя данных (например, приложения); поставщика (провайдера) данных, который содержит и предоставляет данные; служебного компонента, который обрабатывает и транспортирует данные (в частности, процессоры запросов, процессоры курсоров). OLE DB — это единый API, который обрабатывает как совместимые с SQL источники данных, так и несовместимые, такие, как почта и каталоги.

#### Основные понятия OLE DB
OLE DB представляет собой набор COM-интерфейсов, которые предоставляют приложению-клиенту унифицированный доступ к различным  источникам данных. А именно: OLE DB разбивает всю совокупность возможностей и функций СУБД на отдельные фрагменты – COM-объекты с узкой специализацией. Одни объекты выполняют запросы, другие производят обновление, третьи создают структурные  элементы базы данных – таблицы, индексы и представления, четвёртые занимаются управлением транзакциями – например, устанавливают оптимистическую блокировку.

OLE DB – это метод доступа к любым данным, вне зависимости от типа данных и места их расположения. В качестве данных могут выступать реляционные и не реляционные базы данных, картинки, аудиофайлы, электронная почта и другие источники данных.

Средства, предоставляющие доступ к источнику данных с использованием технологии OLE DB, называются OLE DB **провайдерами**. Программы-клиенты, использующие для доступа OLE DB провайдеры, называются **потребителями данных**. В случае, если существует только ODBC-драйвер для доступа к конкретному источнику данных, то для применения технологии OLE DB можно использовать OLE DB провайдер, предназначенный для доступа к ODBC-источнику данных.

Характерной особенностью механизма OLE DB является то, что данные, возвращаемые OLE DB приложению, представляют собой не просто массив информации, а СОМ-объект, обладающий, помимо самой информации, методами управления этой информацией (например, фильтрация и сортировка). Логическая схема доступа к данным с помощью OLE DB представлена на рис. 3.

Приложение, называемое потребителем данных, обращается к поставщику данных, который перенаправляет запрос от приложения к базе данных, либо обрабатывает запрос самостоятельно. Таким образом, поставщик данных аналогичен драйверам ODBC. Механизм OLE DB имеет доступ к ODBC, поддерживая, таким образом, большое количество драйверов, реализованных для ODBC.

#### Объектная модель OLE DB
Спецификация OLE DB определяет набор интерфейсов базового уровня, которые должны реализовываться любыми OLE DB провайдерами. В базовую модель OLE DB входят следующие объекты:
- объект `DataSource` (источник данных), используемый для соединения с источником данных и создания одного или нескольких сеансов. Этот объект управляет соединением, использует информацию о полномочиях и аутентификациях[^аутентификация] пользователя.

- объект `Session` (сеанс) управляет взаимодействием с источником данных – выполняет запросы и создаёт результирующие наборы. Сеанс также может возвращать метаданные[^метаданные]. В сеансе может создаваться одна или несколько команд.

- Спецификация OLE DB определяет объект `Command` (команда), предназначенный для выполнения текстовой команды. В качестве такой команды может выступать и SQL-оператор. При  этом выполнение команды может создавать результирующий набор (в случае SQL-оператора – это оператор SELECT).
- Представление (`View`) определяет группу столбцов из набора данных, но само не содержит их. Представления не могут объединять данные из нескольких наборов таблиц, подмножество строк.

[^аутентификация]: <dfn title="аутентификация">Аутентификация</dfn> (Authentication) — процедура проверки соответствия некоего лица и его учетной записи в компьютерной системе. В простейшем случае проверка происходит с помощью пароля.

[^метаданные]: <dfn title="метаданные">Метаданные</dfn>: <ul><li>информация о данных.</li><li>информация об информации.</li><li>структурированные данные, представляющие собой характеристики описываемых сущностей для целей их идентификации, поиска, оценки, управления ими.</li><li>данные из более общей формальной системы, описывающей заданную систему данных.</li></ul>

OLE DB провайдеры, как и все COM-компоненты, регистрируются в реестре Windows. Для поиска информации о зарегистрированных источниках данных используются специальные объекты, называемые нумераторами. <dfn title="нумератор">Нумератор</dfn> — это обычный СОМ-сервер, позволяющий получить информацию об источниках данных в виде результирующего набора. Для создания такого результирующего набора в объектном типе `DataSource` специфицирован интерфейс `IDBEnumerateSources`.

Для каждого объектного типа спецификация OLE DB определяет набор интерфейсов, который должен обязательно быть реализован для данного объекта. Такие интерфейсы отмечаются как `[mandatory]`. Интерфейсы, которые могут отсутствовать, отмечаются как `[optional]`.

#### Доступ к OLE DB
Будучи COM-интерфейсом, OLE DB непосредственно доступен из C++, C# и Java, но недоступен из Visual Basic и сценарных языков. Поэтому, чтобы использовать OLE DB из любых языков программирования, необходимо использовать объектный интерфейс ADO.

### Технология ADO
OLE DB обеспечивает связывание для программистов на С и C++, а также программистов, использующих языки с С-подобными вызовами функций. Такие языки, как VB и VBScript, не поддерживают тип данных «указатель» (адресных переменных). Следовательно, они не могут использовать связывание в стиле С и прямое обращение к OLE DB.

*[ADO]: ActiveX Database Objects
Вероятно, для большей путаницы разработчики Microsoft ввели еще одну объектную модель доступа к данным: ADO. ADO работает с объектами DAO и RDO, а также поддерживает более простые модели, чем DAO и RDO (хотя с избыточной функциональностью, так что можно выполнить операцию несколькими способами). Объектная иерархия в ADO более однородная, чем в DAO. ADO содержит несколько встроенных объектов, которые упрощают доступ к данным из информационных хранилищ.

<dfn title="ActiveX">ActiveX</dfn> – это фреймворк от Microsoft, используемый для создания программных компонентов, которые могут применяться в различных языках программирования. Технология позволяет интегрировать интерактивные функции на веб-страницы для улучшения взаимодействия с пользователем. ActiveX – технология, на основе которой создаются компоненты для программирования сайтов под Internet Explorer. К настоящему времени ActiveX считается устаревшей технологией, которую не следует использовать для новых разработок. Многие возможности элементов activeX можно выполнять проще и более безопасно с помощью современных технологий, таких как HTML5 и JavaScript, современные расширения браузера или модули WebAssembly.

Технология ADO (от англ. ActiveX Database Objects – механизм доступа к базам данных через объекты ActiveX) – технология доступа к данным, разработанная Microsoft, является надстройкой над механизмом доступа OLE DB и предназначена для унификации работы с поставщиками данных OLE DB. Обеспечивает удобный и надежный доступ к данным, хотя и несколько более медленный, чем в технологиях BDE и dbExpress. Хорошо подходит для работы с системами управления базами данных (СУБД) от фирмы Microsoft (MS Access, MS SQL Server), поскольку не требует дополнительных компонентов (библиотек, драйверов), так как они уже есть на компьютере пользователя.

Механизм ADO предоставляет несколько основных СОМ-объектов, используемых для получения и управления информацией (имеются дополнительные СОМ-объекты, расширяющие функциональность ADO):
- `Connection` для управления соединением с базой данных и передачи запросов поставщику данных;
- `Command` для управления информацией о запросе к базе данных или команде;
- `Recordset`, содержащий таблицу, которая является результатом запроса к базе данных;
- `Field`, содержащий описание поля в таблице, возвращенной поставщиком данных. Список всех полей таблицы содержится в подобъекте `Fields` объекта `RecordSet`;
- `Error`, содержащий расширенную информацию об ошибке, о которой сообщил поставщик данных. Если ошибок несколько, доступ к ним можно получить с помощью объекта `Errors`.

Существует несколько способов, с помощью которых приложение связывается с базой данных. Например, VB-программист может использовать ADO для соединения приложения с провайдером OLE DB. Если база данных не поддерживает OLE DB, приложение может задействовать ODBC. Программист на Visual C++ может применять ADO или соединяться напрямую через OLE DB.

### Технология ADO.NET
Когда Microsoft начала разрабатывать .NET Framework, она имела хорошую возможность пересмотреть модель доступа к данным. Решив не продолжать разработку технологии ADO, специалисты Microsoft приступили к созданию новой структуры доступа к данным, при этом сохранив акроним. Microsoft разрабатывает ADO.NET на базе уже зарекомендовавшей себя объектной технологии ADO. Но ADO.NET ориентируется на три важные возможности, которые не поддерживаются ADO: поддержка модели доступа к несвязанным данным, что является ключевым элементом для работы в Web; поддержка тесной интеграции с XML; интеграция с .NET Framework (например, совместимость с базовой библиотекой классов типичной системы).

ADO.NET является преемником Microsoft ActiveX Data Objects (ADO). Это стандартизированная модель программирования для создания распределенных прикладных программ, нацеленных на совместное использование данных. Подобно ADO, ADO.NET является программным интерфейсом (API) для прикладного программного обеспечения, позволяющим обращаться к данным и другой информации. ADO.NET поддерживает такие современные требования, как создание клиентского интерфейса к базам данных на фронтальном уровне и на уровне промежуточного слоя объектов клиентских приложений, инструментальных средств, языков программирования или Internet браузера.

Технология ADO.NET разработана на основе промышленных стандартов. ADO.NET, подобно ADO, обеспечивает интерфейс доступа к OLE DB — совместимым источникам данных, таким, как Microsoft SQL Server. Прикладные программы, позволяющие пользователям совместно использовать данные, могут использовать ADO.NET для подключения к источниками данных, а также для поиска, управления, и модификации этих данных. Также, прикладные программы (далее ПП) могут использовать OLE DB для управления данными, хранящимися в не относительных форматах, таких, как Microsoft Excel.

В решениях, требующих офлайнового или удаленного доступа к данным, ADO.NET использует XML для обмена данными между программами или с Веб страницами. Любой компонент, который обслуживает XML, также может использовать и компоненты ADO.NET. Если передача пакетов компонентом ADO.NET подразумевает поставку набора данных в файле XML, компонентом, способным обеспечить его получение, может быть только компонент ADO.NET. Передача данных в XML-формате даёт возможность программистам легко отделить обработку данных от компонент пользовательского интерфейса data-sharing ПП, разместив их на отдельных серверах. Это может существенно повысить эффективность и надёжность многопользовательских систем.

Для распределенных ПП, использование наборов данных XML в ADO.NET обеспечивает лучшую эффективность, чем использование COM для офлайнового обслуживания данных в ADO. Поскольку передача наборов данных происходит через файлы XML, описанные в очень простом, принятом повсюду стандарте и являющиеся (по сути) обычными текстовыми файлами, компоненты ADO.NET не имеют ни одного из архитектурных ограничений COM. Наборы данных XML, используемые в ADO.NET избавлены также от необходимости конвертации данных в рекордсете для получения типов данных, применимых в COM. Фактически, любые два компонента могут совместно использовать наборы данных XML при условии, что они оба используют ту же самую схему форматирования набора данных XML. ADO.NET обладает хорошей масштабируемостью, что требуется для совместно использующих данные ПП, работающих на основе Веб. Такие Веб-программы могут обслужить десятки, сотни, а то и тысячи пользователей. ADO.NET не применяет длительные блокировки баз данных или такие активные подключения, которые на долгое время монополизируют ресурсы сервера, являющимися (как правило) весьма ограниченными. Это позволяет увеличивать число пользователей без значительного увеличения утилизации ресурсов системы.

#### Архитектура и принцип работы ADO.NET
Объект `Recordset`, который выполняет так много функций в ADO, здесь отсутствует. Вместо него в ADO.NET предусмотрено несколько особых объектов, выполняющих специфические задачи. Три важнейших из них: `DataAdapter`, `DataReader` и `DataSet`.

Очень важный компонент ADO.NET, поставщик (провайдер) данных .NET, реализует интерфейсы ADO.NET. В частности, он реализует объект `DataReader` так, что его могут использовать и приложение, и объект `DataSet`.

Поставщик данных .NET состоит из четырех основных компонентов: `Connection` — для связи с источником данных; `Command` выполняет команды над источником данных; `DataReader` читает данные из источника данных в однонаправленном режиме «только чтение», и `DataAdapter`, который читает данные из источника данных и использует их для заполнения объекта `DataSet`.

Visual Studio .NET содержит два поставщика данных .NET.
*[TDS]: Tabular Data Stream

- *Поставщик данных SQL Server .NET* обеспечивает связь с SQL Server 7.0 и более поздними версиями. Этот метод доступа наиболее эффективен для SQL Server 7.0 и выше, потому что поставщик данных SQL Server .NET связывается напрямую с SQL Server через протокол Tabular Data Stream (TDS).
- *Поставщик данных OLE DB .NET* необходим для соединения с отличными от SQL Server базами данных, такими, как Oracle или IBM DB2. Этот поставщик данных использует OLE DB для соответствующих баз данных.

Существуют различные пути, по которым приложение может связываться с базой данных через ADO.NET. При выборе пути сначала определяется, какой поставщик данных .NET будет использоваться. Если это SQL Server 7.0 или более поздняя версия, то подключается поставщик данных SQL Server.NET. Если база данных SQL Server 6.5 или отличная от SQL Server (например, Oracle), понадобится поставщик данных OLE DB .NET. Заметим, что можно задействовать поставщик данных OLE DB .NET для баз данных SQL 7.0 и выше, но тогда потеряется выигрыш в производительности, который дает прямое подключение к SQL Server через протокол TDS. Однако в этом неспецифическом способе есть свой плюс — мобильность, т. е. можно менять базы данных без модификации кода.

Далее необходимо определить, какую задачу требуется выполнить. Если надо просто прочитать и отобразить данные из источника данных, объекта Data Reader вполне достаточно. Но если предстоит манипулировать данными (например, редактировать или удалять), нужно использовать объект Data Set. Хотя задействовать этот объект следует только в случае необходимости, потому что он работает медленнее, чем Data Reader (Data Set использует Data Reader для заполнения таблиц).

#### Сравнение ADO и ADO.NET
ADO.NET — эволюционное развитие ADO. Самый простой путь быстрого понимания преимуществ ADO.NET состоит в сравнении с ADO.

| Термин  | ADO  | ADO.NET |
-- | -- | --
Резидентное представление данных в памяти | Использует объект RecordSet, который напоминает отдельную таблицу. | Использует объект DataSet, который может содержать одну или более таблиц, представленных объектами DataTable
Отношения между множеством таблицами | Требует, чтобы запрос JOIN транслировал данные из объединяемых таблиц базы данных в отдельную, результирующую таблицу. | Поддерживает объект DataRelation, чтобы сопоставить строки в одном объекте DataTable со строками в другом объекте DataTable.
Инспектирование данных | Последовательное сканирование данных DataSet | Использует навигационную парадигму для непоследовательного доступа к строкам в таблице. Следует за отношениями, чтобы передвигаться от строк в одной таблице к соответствующим строкам в другой таблице.
Офлайновый доступ | Использует RecordSet, для которого типична поддержка соединения, представленная объектом Connection. Вы подключаетесь к базе данных посредством запросов к OLE DB провайдеру. | Подключается к базе данных посредством стандартизированных запросов к объекту DataSetCommand, который подключается к OLE DB провайдеру (а иногда, непосредственно к API, обеспечивающемуся СУБД).
Программируемость | Использует объект Connection, чтобы передать команды, адресуемые источникам данных, лежащим в основе конструкции данных. | Использует строгий формат программирования характеристик XML. Данные включают в себя собственные описатели, поэтому, имена элементов кода отражают реальные проблемы, решаемые кодом. Лежащие в основе конструкций данных типы таблиц, строки, и таблицы, делают код проще для понимания и написания.
Совместное использование офлайновый данных между уровнями или компонентами | Использует COM для передачи RecordSet в офлайне. Поддерживаются только те типы данных, которыми располагает стандарт COM. Требуется преобразование типов, которое отнимает системные ресурсы. | Передает DataSet с XML файлом. Формат XML не имеет никаких ограничений на типы данных и не требует никаких преобразований типов.
Передача данных через межсетевые экраны (firewalls) | Проблематично, потому что межсетевые экраны обычно конфигурируются так, чтобы предотвратить запросы системного уровня, которые используются в COM. | Поддерживается, потому что объекты DataSet, используемые ADO.NET, передают XML, разработанный на основе HTML, который может проходить через межсетевые экраны.
Масштабируемость | Блокировки баз данных и длительные, активные подключения к базам данных могут стать причиной коллизий и сильно ограничивать ресурсы базы данных. | Офлайновый доступ к базам данных без накладывания длительных блокировок или применения длительных, активных подключений к базе данных, существенно разгружает ресурсы базы данных.

### Работа с базами данных в .NET Framework
Работа с базами данных повсеместно встречается в современных приложениях, будь то настольное приложение, веб-сайт или веб-служба. Естественно платформа .NET Framework предлагает множество способов взаимодействия с базами данных из управляемого кода, которые и описываются в данном разделе нашего сайта. Основной системой управления базами данных для Windows являтся SQL Server, администрирование которой мы также опишем.

- **ADO.NET**

    Платформа .NET Framework включает собственную технологию доступа к данным — ADO.NET. Эта технология состоит из управляемых классов, позволяющих приложениям .NET подключаться к источникам данных (обычно реляционным базам данных), выполнять команды и управлять автономными данными. Маленькое чудо ADO.NET заключается в том, что эта технология позволяет писать более-менее одинаковый код для доступа к данным — как в веб-приложениях, так и в клиент-серверных настольных приложениях, и даже в однопользовательских приложениях, подключаемых к локальной базе данных.

- **Entity Framework 6**

    API-интерфейс Entity Framework спроектирован для работы с любыми базами данных, поддерживающими ADO (а не только с SQL Server), и даже включает собственный диалект независимого от поставщика языка SQL, который можно применять в качестве альтернативы LINQ.

- **SQL Server 2012 и язык T-SQL**

    Система управления базами данных SQL Server является наилучшим выбором для широкого диапазона конечных пользователей и программистов баз данных, работающих над созданием бизнес-приложений. В целом, SQL Server является больше, чем просто системой управления реляционными базами данных. Это платформа, которая не только позволяет управлять структурированными, полуструктурированными и неструктурированными данными, но также предоставляет комплексное, интегрированное системное программное обеспечение и программное обеспечение для аналитических исследований, которые позволяют организациям надежно управлять критически важными данными.

- **Оконные функции T-SQL**

    Одним из самых фундаментальных расширений языка SQL в Microsoft SQL Server 2005 стало добавление оконных функций с такими синтаксическими конструкциями, как предложение `OVER` и набор новых функций, известных как функции ранжирования (`ROW_NUMBER`, `RANK`, и других). В отличие от обычных агрегатных функций, оконные функции не группируют строки в одну выходную строку, а добавляют результаты вычислений к каждой строке результирующей выборки как новое поле. Это позволяет сохранить уникальные идентификаторы строк и упростить выполнение аналитических расчетов. Это добавление позволило решать стандартные проблемы более простым, интуитивно понятным и отличающимся более высокой производительностью способом, чем раньше.
